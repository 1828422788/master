Feature: 输入SPL语句，检查搜索完成后的事件数

  Background:
    Given I click the "LocateSearchPage" button
    And I will see the "splSearch.SearchPage" page

  @smoke @spl
  Scenario Outline: 直接在搜索框中输入相应的spl语句来进行查询
    Given I set the parameter "SearchInput" with value "<splQuery>"
    And I click the "DateEditor" button
    And I click the "Today" button
    And I click the "SearchButton" button
    And I wait element "SearchStatus" change text to "搜索完成!"
    Then I will see the "SearchResult" will between "<lowerLimit>" and "<topLimit>"

    Examples:
      | splQuery                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | lowerLimit | topLimit |
#     多索引
      | index=yott* ERROR AND tag:sample04061424*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 200        | 300      |
      | index=* ERROR AND tag:sample04061424*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 200        | 300      |
      | index=schedule schedule_name:resp_len_in_minute                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |            |          |
      | (index=yotta starttime="-5h" endtime = "now" tag:sample04061424) OR ( index=machine* starttime="-1000d/d" endtime="now"  appname:java)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 12180      | 29799    |
      | index=*,schedule starttime="-5h" endtime = "now" ERROR AND tag:sample04061424*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 200        | 300      |
#      | index=machine*,yott* starttime="-1000d" endtime = "now" appname:disk OR tag:sample04061424                                                                                                                                      | 10433      |
#      | index=machine*,yott* starttime="-5h" endtime = "now" appname:disk OR tag:sample04061424                                                                                                                                         |            |
      | (index=yotta starttime="-5h" endtime = "now" tag:sample04061424) OR ( index=machine* starttime="-1000d/d" endtime="now"  appname:java) \| bucket timestamp span=1d as ts \| stats count() as cnt by ts \| esma cnt timefield=ts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 12183      | 15000    |
      | (index=yotta starttime="now/d" endtime="now" tag:sample04061424  AND [[ tag:sample04061424 \| limit 1 \| fields apache.method ]]) AND ( index=yotta [[ tag:sample04061424 \| limit 1 \| fields  apache.status]])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 49         | 49       |
#    下行有统计图表需要校验
      | index=yott* starttime="-5h/h" endtime="now" tag:"sample04061424" \| eval time = formatdate(timestamp, "HH") \| stats avg(apache.status) by time \| join type=left time [[ index=machine* starttime="-1000d" endtime="now" appname:houses  \| eval time = tolong(floor(json.median_house_value)) \| stats avg(json.property_tax_rate) by time]]                                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
#    |index=apache starttime="-5h/h" endtime="now" tag:"sample04061424" | stats avg(apache.status) by apache.clientip | join type=inner apache.clientip [[ index=yotta* appname:second AND tag:"sample04061424" AND apache.clientip:23.166.125.53 | stats sum(apache.status) by apache.clientip ]]|     |                                             |
      | index=apache,yotta* starttime="-5h/h" endtime="now" tag:"sample04061424" AND apache.referer_domain:*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 40         | 80       |
      | index=yotta starttime="-5h" endtime = "now" tag:sample04061424*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 2129       | 4926     |
      | index=machine* starttime="-1000d" endtime="now" appname:houses                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 查询无结果      |          |
#    基础搜索
      | index=yotta tag:sample04061424                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
      | index=yotta *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1          |          |
      | index=internal *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |            |          |
      | index=schedule *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |            |          |
#    |tag:"sample04061424" AND /[0-1][0-8]0{2,2}                                                                                                                                                                                                                                                                                                      |            |          |
#     spl测试用例
      | starttime="now-1M/M-1d/w"  endtime="now" tag:sample04061424                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |            |          |
      | starttime=2018-04-08 endtime=2018-04-08:23:59:00 tag:sample04061424                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 72         | 72       |
      | starttime="-5h/h" endtime="now" tag:sample04061424                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 72         | 72       |
      | starttime="-2d/d" endtime="now/d" logtype:apache \| stats count(apache.resp_len) as event_count, max(apache.resp_len) as max_len, avg(apache.resp_len) as avg_status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |            |          |
      | index=yotta tag:sample04061424 AND  /[0][8]0{2,2}/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 72         | 72       |
#      top字段，需单独验证
      | tag:sample04061424 \| eval len=if(empty(apache.resp_len),0,1) \| stats top(len,10)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |            |          |
#      3列2行
      | tag:sample04061424 \| eval is_resplen_empty=empty(apache.resp_len) \| eval res_str=if(is_resplen_empty,"repslen_empty","resplen_non_null") \| table apache.resp_len, is_resplen_empty, res_str \| where is_resplen_empty==true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
#3列70行
      | tag:sample04061424 AND apache.resp_len:* \| eval res_mul=apache.resp_len*apache.status*0 - apache.resp_len*apache.status/apache.status%1000 \| eval r_add=apache.resp_len+apache.status*10-apache.resp_len-9*apache.status \| eval res_concat = appname + apache.clientip + apache.geo.city \| table res_mul, r_add, res_concat                                                                                                                                                                                                                                                                                                                                                                                 | 70         | 70       |
#4列
      | tag:"sample04061424" AND apache.resp_len:>2000 \| eval resplen=apache.resp_len \| eval status=apache.status \| eval mid=apache.resp_len+apache.status \| eval res_mul=(apache.resp_len+apache.status)*apache.status \| table resplen, status, mid, res_mul                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 29         | 29       |
      | tag:"sample04061424_json_sdyd_float_59" \| eval res_empty=empty(json.cpuTime) \| eval res_not_empty=!empty(json.cpuTime) \| eval res_true=empty(json.cpuTime) \|\| true \| eval res_false= false && empty(json.cpuTime) \| table json.cpuTime, res_empty, res_not_empty, res_true, res_false                                                                                                                                                                                                                                                                                                                                                                                                                    | 59         | 59       |
#    9列
      | tag:"sample04061424" AND NOT apache.status:200 \| eval not200_true=apache.status!=200 \| eval is200_false=apache.status==200 \| eval big200_true=apache.status>200 \| eval bigto200_true=apache.status>=200 \| eval small200_false=apache.status<200 \| eval smallto200_false=apache.status<=200 \| eval res_other200=if(apache.status==200,"equal200","other200") \| eval res_not200=if(apache.status!=200,"not200","error") \| table apache.status, not200_true, is200_false, big200_true, bigto200_true,small200_false,smallto200_false,res_other200, res_not200                                                                                                                                             | 23         | 23       |
#      4列
      | tag:sample04061424_json_sdyd_float_59 \|  eval r_abs=abs(json.duration) \| eval r_ceil=ceil(json.duration) \| eval r_floor=floor(json.duration) \| table json.duration,r_abs, r_ceil, r_floor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 59         | 59       |
#     5列
      | tag:sample04061424_json_sdyd_41 \| eval res_ceil=ceil(json.cpuTime) \| eval res_floor=floor(json.cpuTime) \| eval res_min=min(json.execTime,json.responseTime) \| eval res_max=max(json.execTime,json.responseTime) \| eval res_log_time=log(agent_send_timestamp) \|table res_ceil, res_floor, res_min, res_max, res_log_time                                                                                                                                                                                                                                                                                                                                                                                  | 37         | 37       |
      | tag:sample04061424_json_sdyd_41  \| eval r_min=min(json.execTime,json.responseTime) \| eval r_max=max(json.execTime,json.responseTime) \| eval r_log_time=log(agent_send_timestamp) \|table r_min, r_max, r_log_time                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 41         | 41       |


#    以下为自动生成，仍需改动
      | tag:"sample04061424" AND apache.resp_len:* \| eval res_min=min(apache.status,apache.resp_len) \| eval res_max=max(apache.status,apache.resp_len) \| table res_min,res_max                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 70         | 70       |
      | tag:"sample04061424" AND apache.resp_len:*  \| eval r_log_f=log(apache.resp_len) \| eval r_log_int = log(apache.status) \| table r_log_f, r_log_int                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 70         | 70       |
      | tag:sample04061424_json_sdyd_float_59 \| eval r_len_e=len(json.application) \| eval r_len_c=len(json.name) \| table json.application, json.name, r_len_e, r_len_c                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 59         | 59       |
      | tag:sample04061424 AND NOT apache.resp_len:* \| eval a = coalesce(apache.resp_len,apache.status) \| eval b = coalesce(apache.status,apache.resp_len) \| table a, b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2,         | 2,       |
      | tag:sample04061424 AND NOT apache.status:200\| eval r_status = "status: " + case(apache.status==200, "ok", apache.status==400, "bad", apache.status>=500, "other", default, "error") \| table apache.status, r_status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 23         | 23       |
      | tag:"sample04061424"  AND apache.status:404 \| eval res_case=case(apache.status==200,"status=200",apache.status>=301,"apache>=301",apache.status==304,"apache==304",default,"apache=other") \| table apache.status, res_case                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 11         | 11       |
      | tag:sample04061424 AND apache.status:>=301 \| eval r_status=case(apache.status==200,"status=200",apache.status<=301,"apache<=301",apache.status==304,"apache==304",default,"apache=other") \| table r_status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 22         | 22       |
      | tag:sample04061424 OR  tag:sample04061424_json_sdyd_41 \| eval test=case(logtype=="json", json.cpuTime, logtype=="apache", apache.resp_len) \| table test                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 11         | 11       |
      | tag:"sample04061424" AND apache.request_path:* \| eval r_upper=upper(apache.request_path) \| eval r_lower=lower(apache.request_path) \| table r_upper, r_lower                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
      | tag:"sample04061424" \| eval r_match =match(apache.clientip, "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}") \| table apache.clientip, r_match                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 72         | 72       |
      | tag:"sample04061424" AND apache.request_query:* \| eval r_match1 = match(apache.request_query, "b.*e") \| eval r_match2 = match(apache.request_query, "^bcd") \| table apache.request_query, r_match1, r_match2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 55         | 55       |
      | tag:"sample04061424" AND apache.referer_domain:* \| eval r_subdomain= substring(apache.referer_domain,0,len(apache.referer_domain)) \| eval r_trim=trim("中文 ") \| eval r_eng=trim(" "+apache.referer_domain + " ") \| eval r_cat = r_trim+r_eng+"_"+r_subdomain \| table r_subdomain, r_cat                                                                                                                                                                                                                                                                                                                                                                                                                     | 40         | 40       |
      | tag:"sample04061424" \| eval res_to_str=tolong("123") \| eval res_to_long=tolong(20.3) \| table res_to_str, res_to_long                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424" \| eval r_frm_str=todouble("123.1")  \| eval r_frm_long = todouble(20) \| eval res=r_frm_str+20\| eval t_frm_str = typeof(r_frm_str) \| eval t_frm_long = typeof(r_frm_long) \| eval t_res = typeof(res) \| table r_frm_str, t_frm_str, r_frm_long,t_frm_long, res,t_res                                                                                                                                                                                                                                                                                                                                                                                                                   | 72         | 72       |
      | tag:sample04061424_json_sdyd_41 \| eval t_cputime = typeof(json.cpuTime) \| eval t_actionName=typeof(json.actionName) \| eval t_failed=typeof(json.failed) \| eval t_time=typeof(agent_send_timestamp)  \| eval t_dimensions_ip=typeof(json.dimensions.IP) \| table t_cputime, t_actionName,t_failed,t_time,t_dimensions_ip                                                                                                                                                                                                                                                                                                                                                                                     | 41         | 41       |
      | tag:"sample04061424" \| eval t = "logtype:" + logtype \| where tostring(t) == "logtype:apache" && tostring(apache.clientip) == "23.166.125.53" && tostring(appname) == "apache" \| table apache.clientip, appname, t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 72         | 72       |
      | tag:"sample04061424" apache.method:GET \| eval x = parsedate("28/04/2016:12:01:01","dd/MM/yyyy:HH:mm:ss") \| eval y = parsedate("28/04/2016","dd/MM/yyyy") \| table x,y                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424" apache.method:GET \| eval x = parsedate("28/04/2018", "dd/MM/yyyy",'zh') \| table x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 可能         | 可能       |
      | tag:"sample04061424" apache.method:GET \| eval r_formatdate = formatdate(timestamp, "HH:mm:ss:SSS MM/dd/yyyy") \| table timestamp, r_formatdate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 72         | 72       |
      | tag:"sample04061424" \| eval x_format = format("%s, %s => %s", logtype, tag, apache.clientip) \| table x_format                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 72         | 72       |
      | tag:"sample04061424" \| eval r_isnum = isnum(apache.status) \| eval r_isstr = isstr(apache.method) \| table r_isnum, r_isstr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 72         | 72       |
      | tag:"sample04061424" \| eval r_relative = relative_time(timestamp, "-1d/d") \| eval r_format_relative = formatdate(r_relative, "HH:mm:ss:SSS MM/dd/yyyy") \| eval r_format_timestamp = formatdate(timestamp, "HH:mm:ss:SSS MM/dd/yyyy") \| table timestamp, r_format_timestamp, r_relative, r_format_relative                                                                                                                                                                                                                                                                                                                                                                                                   | r_         | r_       |
      | tag:"sample04061424" \| eval r_m130 = cidrmatch("192.168.1.130/25", "192.168.1.129") \| eval r_m128 = cidrmatch("192.168.1.128/25", "192.168.1.129") \| eval r_m255 = cidrmatch("192.168.1.255/25", "192.168.1.129") \| table r_m130, r_m128, r_m255                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 72         | 72       |
      | tag:sample04061424_urldecode_apache_10 AND apache.request_query:* \| eval r_decode = urldecode(apache.request_query) \| table apache.request_query,r_decode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 10         | 10       |
      | tag:"sample04061424" \|eval a=add(apache.status,3) \| sort a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 0，         | 0，       |
      | tag:"sample04061424" \| eval method = apache.method \| stats count() as count1, avg(apache.resp_len) as avg_len by method, apache.status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 72         | 72       |
      | tag:"sample04061424" \| transaction apache.resp_len \| where _count==4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 72         | 72       |
      | tag:"sample04061424" \| transaction apache.resp_len \| where _duration==1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 72         | 72       |
      | tag:"sample04061424" \| transaction apache.clientip endswith=eval(apache.status == 200) maxevents=10 contains="Dalvik"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 72         | 72       |
      | starttime = "-5h/h" endtime = "now" tag:"sample04061424" \| transaction apache.clientip startswith="Android" endswith="Dalvik" maxspan=5s maxevents=50 maxopentxn=1000 maxopenevents=1000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 每个         | 每个       |
      | starttime = "-5h/h" endtime = "now" tag:"sample04061424" \| transaction apache.clientip startswith="Android" endswith="AndroidPhone" maxspan=1d maxevents=50 maxopentxn=1000 maxopenevents=1000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 因无         | 因无       |
      | tag:"sample04061424" \| transaction apache.resp_len \| sort by apache.resp_len                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 29         | 29       |
      | tag:"sample04061424" \| transaction apache.resp_len \| stats count(apache.resp_len)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 结果         | 结果       |
      | tag:"sample04061424" \| transaction apache.status, apache.method \| stats count() as cnt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 72         | 72       |
      | tag:"sample04061424" \| stats count(apache.status),min(apache.status),max(apache.status),avg(apache.status),sum(apache.status), es(apache.status) by apache.clientip                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 27         | 27       |
      | tag:"sample04061424" \| stats count(apache.status),min(apache.status),max(apache.status),avg(apache.status),sum(apache.status), extend_stat(apache.status) by apache.clientip                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 27         | 27       |
      | tag:"sample04061424" \| where apache.status>400 \| stats dc(apache.status)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 22         | 22       |
      | tag:"sample04061424" \| where apache.status>400 \| stats es(apache.status)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 22         | 22       |
      | tag:"sample04061424" \| where apache.status>400 \| stats extend_stat(apache.status)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 22         | 22       |
      | tag:"sample04061424" \| stats count() as cnt by apache.status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 72         | 72       |
      | tag:"sample04061424" \| sort by +apache.status,+apache.resp_len\| table apache.status, apache.resp_len                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 72         | 72       |
      | tag:"sample04061424" \| stats avg(apache.resp_len) as avg_length by apache.status  \| sort by avg_length \| eval eval_length = avg_length + 200                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 如果         | 如果       |
      | tag:"sample04061424" \| stats avg(apache.resp_len) as avg_length by apache.status \| eval eval_length = avg_length + 200 \| sort by eval_length                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 代替         | 代替       |
      | tag:"sample04061424" \| stats avg(apache.resp_len) as avg_length, count(apache.clientip) as ip_count by apache.status \| sort by ip_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 72         | 72       |
      | tag:"sample04061424" \| stats count() as cnt, max(apache.status) as r_max by apache.clientip \| stats avg(cnt) by r_max                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 两例         | 两例       |
      | tag:"sample04061424" \| stats count() as cnt, max(apache.status) as r_max by apache.clientip \| top 3 cnt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 72         | 72       |
      | tag:"sample04061424" \| top 50 apache.resp_len                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 结果         | 结果       |
      | starttime="-3d/d" endtime="now" tag:"sample04061424" \| top 50 apache.resp_len                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 同上         | 同上       |
      | tag:"sample04061424" \| top 3 apache.clientip by apache.request_path                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 72         | 72       |
      | tag:"sample04061424" \| top 11 apache.clientip countfield=clientip_count  percentfield=clientip_percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats count(apache.clientip) as c_ip by ts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 72         | 72       |
      | tag:"sample04061424" \| bucket timestamp span=10m as ts\|stats count(appname) as count_app by ts\|eval time=formatdate(ts)\| autoregress count_app p=6\|eval rate=if(empty(count_app_p6),0,abs(count_app_p6-count_app)) \| eval result=if(empty(count_app_p6),0,1) \|where result>0\|fields count_app,time,count_app_p6,rate                                                                                                                                                                                                                                                                                                                                                                                    | 72         | 72       |
      | tag:"sample04061424" \| bucket timestamp span=3h as ts\| stats count(appname) as count_ by ts\| movingavg count_,5 as ma\| rollingstd count_,5 as rs\| eval lower=ma-1*rs\| eval upper=ma+1*rs\| eval outlier=if(count_>upper\|\|count_<lower, count_, 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 72         | 72       |
      | starttime="-5h/h" endtime="now" tag:"sample04061424" \| bucket timestamp timeranges=((MIN,-2h),(-2h,-1h),(-1h,MAX)) as ts \| table ts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 72         | 72       |
      | starttime="-5h/h" endtime="now" tag:"sample04061424" \| bucket timestamp timeranges=((-2d, -1d),(-1d, MAX),(2018-04-08:00:00:00, 2018-04-09:00:00:00)) as tr \| stats count(appname) as ct by tr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 72         | 72       |
      | tag:"sample04061424" \| rename apache.status as "status_1" \| table apache.status,status_1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 72         | 72       |
      | tag:"sample04061424" \| rename apache.status as "状态码" \| table '状态码'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 新增         | 新增       |
      | tag:"sample04061424" \| where  apache.status > 200 && apache.status < 400 \| table apache.status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 20         | 20       |
      | tag:"sample04061424"\| limit 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 72         | 72       |
      | starttime="-5h/h" endtime="now" tag:"sample04061424" \| stats count() as count_res by appname,apache.clientip \| fields apache.clientip, count_res                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 72         | 72       |
      | tag:"sample04061424" AND [[ tag:"sample04061424"  \| stats count(apache.clientip) as count_ by apache.clientip \| sort by count_ \| limit 1 \| fields apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 结果         | 结果       |
      | tag:"sample04061424" AND [[tag:"sample04061424" \| stats es(apache.status) by apache.method \| fields apache.method]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 等价         | 等价       |
      | [[ tag:"sample04061424"\| stats count(apache.clientip) by apache.clientip, apache.method \| limit 2 \| fields apache.clientip apache.method ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 结果         | 结果       |
      | [[ tag:"sample04061424"  \| stats count(apache.clientip) as count_ by apache.clientip \| sort by count_ \| limit 1  ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 结果         | 结果       |
      | tag:"sample04061424" \| stats dc(apache.status) as dc_count by apache.method \| join apache.method [[ tag:"sample04061424" \| stats count(apache.status) as cnt by apache.method \| append [[ tag:"sample04061424" \| stats count() as total ]] ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 为什         | 为什       |
      | starttime="-d/d" endtime="now/d" tag:"sample04061424"  \| append [[ starttime="-5h" endtime="now" tag:"sample04061424" apache.status:200 AND apache.method:"GET" \| append [[ tag:"sample04061424" \| stats count() as cnt by apache.status]] ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 12         | 12       |
      | tag:"sample04061424" \| stats avg(apache.status) by apache.clientip \| join type=left apache.clientip [[ tag:"sample04061424" AND apache.clientip:23.166.125.53 \| stats sum(apache.status) by apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 72         | 72       |
      | tag:"sample04061424"\| fields apache.method apache.clientip \| join type=left apache.clientip [[ tag:"sample04061424" \| stats sum(apache.status) by apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424" \| stats count(logtype) as count_all by apache.geo.isp \| sort by count_all \| limit 20 \| join type=left apache.geo.isp [[tag:"sample04061424" AND apache.status:[400 TO 499] \| stats count(logtype) as count_400l by apache.geo.isp]] \| join type=left apache.geo.isp [[tag:"sample04061424" AND apache.status:[500 TO 599] \| stats count(logtype) as count_500l by apache.geo.isp]]                                                                                                                                                                                                                                                                                                  | 72         | 72       |
      | tag:"sample04061424" \| stats avg(apache.status) by apache.clientip \| join type=inner apache.clientip [[ tag:"sample04061424" AND apache.clientip:23.166.125.53 \| stats sum(apache.status) by apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 72         | 72       |
      | tag:"sample04061424" \| stats avg(apache.status) by apache.clientip \| join type=inner apache.clientip [[ tag:"sample04061424" AND apache.clientip:23.166.125.53 \| stats sum(apache.status) by apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 72         | 72       |
      | starttime = "-5h/h" endtime = "now" tag:"sample04061424" \| fields apache.clientip, apache.method \| join type=inner apache.clientip [[starttime = "-5h/h" endtime = "now" tag:"sample04061424" \| stats avg(apache.status) as sub_status by apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 72         | 72       |
      | tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats count() as ip_count by apache.clientip,ts \| join type=left ts [[ tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats count() as hour_count by ts ]] \| eval ippercent=100 * ip_count / hour_count \| eval r_fomart = formatdate(ts)                                                                                                                                                                                                                                                                                                                                                                                                | 72         | 72       |
      | tag:"sample04061424" \| stats count(logtype) as count_all by apache.geo.isp \| sort by count_all \| limit 5 \| join type=left apache.geo.isp[[logtype:"apache" AND apache.status:[400 TO 499]\|stats count(logtype) as count_400 by apache.geo.isp]]\|join type=left apache.geo.isp [[logtype:"apache" AND apache.status:[500 TO 599]\|stats count(logtype) as count_500 by apache.geo.isp]]\|join type=left apache.geo.isp [[logtype:"apache" AND apache.resp_len:>1000\|stats count(logtype) as len_1000 by apache.geo.isp]]\|eval rate_400=if(empty(count_400),0,count_400/count_all)\|eval rate_500=if(empty(count_500),0,count_500/count_all)\|eval rate_len_1000=if(empty(len_1000),0,len_1000/count_all) | 72         | 72       |
      | tag:"sample04061424" \| stats count() by hostname \| lookup user,department /data/rizhiyi/share/host_user.csv on hostname = host                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 72         | 72       |
      | tag:"sample04061424" \| stats avg(apache.resp_len) as status,count(apache.resp_len) by apache.clientip \| save /data/rizhiyi/spldata/apache_latency.csv                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats sum(apache.resp_len) as sum_resp_len by ts  \| rollingstd sum_resp_len,10 as resp_len_rolling_std                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Su         | Su       |
      | tag:"sample04061424"\|bucket timestamp span=1h as ts \| stats sum(apache.resp_len) as sum_resp_len by ts \| eval time=formatdate(ts)\| movingavg sum_resp_len,3 as moving_avg_resp_len                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Su         | Su       |
      | starttime="-5h/h" endtime="now" tag:"sample04061424" \| bucket timestamp span=10m as ts \| stats count(appname) as count_app by ts \| eval time=formatdate(ts) \| autoregress count_app p=6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 72         | 72       |
      | starttime="-5h/h" endtime="now" tag:"sample04061424"\| bucket timestamp span=10m as ts \| stats count(appname) as count_app by ts\|eval time=formatdate(ts)\| autoregress count_app p=6\|eval rate=if(empty(count_app_p6),0,abs(count_app_p6-count_app)) \| eval result=if(empty(count_app_p6),0,1) \| where result>0\|fields count_app,time,count_app_p6,rate                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
      | tag:"sample04061424" \| eval  avg_resp_len = apache.resp_len \| autoregress avg_resp_len p=1-2 \| eval res_avg = (avg_resp_len + avg_resp_len_p2 + avg_resp_len_p1) / 3 \| top 3 res_avg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 72         | 72       |
      | starttime="-1d/d" endtime="now/d"  tag:"sample04061424" \| stats avg(apache.resp_len) as avg_resp_len \| append [[ starttime="now/d" endtime="now" tag:"sample04061424" \| stats avg(apache.resp_len) as avg_resp_len]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 验证         | 验证       |
      | tag:"sample04061424" \| stats count(apache.clientip)  \| append [[ index=schedule * \| stats count(apache.clientip) ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 72         | 72       |
      | tag:"sample04061424" \| stats avg(apache.resp_len) \| eval day="the day today" \| append [[ starttime="-1d/d" endtime="now/d" * \| stats avg(apache.resp_len) \| eval day="yesterday" ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 72         | 72       |
      | starttime="-1d/d" endtime="now"  tag:"sample04061424" \| bucket timestamp span=5h as ts \| stats max(apache.resp_len)as count_1 by ts \| eval time=formatdate(ts) \| eval line="max_line" \| append [[starttime="-5h/h" endtime="now"  tag:"sample04061424" \| bucket timestamp span=5h as ts \| stats max(apache.resp_len) as count_2 by ts \| eval time=formatdate(ts)\|eval line="count_line"]]                                                                                                                                                                                                                                                                                                              | 2行         | 2行       |
      | tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats es(apache.status) by ts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424_urldecode_apache_10" \| eval new_time=formatdate(timestamp, "yyyy-MM-dd HH:mm:ss") \| table apache.status,apache.method,timestamp,new_time                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 10         | 10       |
      | tag:"sample04061424" \| table apache.status, apache.method, appname, tag \| fields  appname, tag, apache.status, apache.method                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
      | tag:"sample04061424" \| stats count() as cnt, max(apache.status) as r_max by apache.clientip \| stats max(cnt),max(r_max)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 72         | 72       |
      | tag:"sample04061424" \| stats count() as cnt, max(apache.status) as r_max_status by apache.clientip \| top 3 r_max_status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 72         | 72       |
      | tag:"sample04061424" \| parse field=apache.clientip "(?<ip_addr>\d+\.\d+\.\d+\.\d+)" \| eval ip_str = "ip:" + ip_addr  \| stats count(appname) by ip_str                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 72         | 72       |
      | tag:"sample04061424" \| parse field=apache.request_path "^(?<outer_path>/[^/]*)" \| stats count(appname) by outer_path                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 72         | 72       |
      | tag:"sample04061424" \| stats count() as cnt by apache.method, apache.status \| transpose row=apache.method column=apache.status valuefield=cnt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 72         | 72       |
      | tag:"sample04061424" \| stats pct(apache.status,1,5,25,50,75,95,99) as pct_ by apache.method \| transpose row=pct_.1 column=apache.method valuefield=pct_.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 72         | 72       |
      | tag:"sample04061424" \| table apache.geo.longitude,apache.geo.latitude,apache.geo.city \| transpose  row=apache.geo.longitude column=apache.geo.latitude valuefield=apache.geo.city                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 数据         | 数据       |
      | tag:"sample04061424" \| eval long=apache.geo.longitude \| eval lat=apache.geo.latitude \| eval city=apache.geo.city  \| table long, lat, city \| transpose row=lat column=long valuefield=city                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Su         | Su       |
      | starttime="-1d/h" endtime="now/h" tag:"sample04061424"\|bucket timestamp span=1h as ts\|stats count() as count_app by ts\|eval time=formatdate(ts)\|autoregress count_app p=3 \|transpose row=ts column=time valuefield=count_app                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Su         | Su       |
      | starttime="-w/w" endtime="now" tag:"sample04061424" \| bucket timestamp span=1d as ts \| stats count() as cnt by ts \| esma cnt timefield=ts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 当开         | 当开       |
      | starttime="-w/w" endtime="now" tag:"sample04061424" \| bucket timestamp span=1d as ts \| stats avg(apache.resp_len) as cnt by ts \| esma cnt timefield=ts \| eval r_fmt_time=formatdate(ts)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 6列         | 6列       |
      | starttime="-w/w" endtime="now" logtype:apache \| bucket timestamp span=1d as ts \| stats count() as cnt by ts \| esma cnt timefield=ts futurecount=30 \|eval new_tt=formatdate(ts)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 6列         | 6列       |
      | starttime="now-7d/d" endtime="now/d" tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats avg(apache.status) as avg_ by ts \| esma avg_ timefield=ts futurecount=24 \| eval r_fmt=formatdate(ts)  \| where typeof(_predict_avg_)=="double" \| eval time = formatdate(ts, "HH:mm") \| table time, _predict_avg_ \| join type=left time [[ starttime="now/d"  tag:"sample04061424" \| bucket timestamp span=1h as ts \| stats avg(apache.status) as avg_ by ts \| eval time = formatdate(ts, "HH:mm") \| table time, avg_ ]]                                                                                                                                                                           | 3列         | 3列       |
      | tag:"sample04061424" \| dedup 3 apache.status \| sort by apche.resp_len                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 72         | 72       |
      | tag:"sample04061424" \| dedup 3 apache.version keepevents=true \| sort by timestamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 72         | 72       |
      | tag:"sample04061424" \| dedup 3 apache.method, appname keepevents = true \| sort by timestamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 全部         | 全部       |
      | tag:"sample04061424" \| dedup 3 apache.status,appname keepevents = false \|sort by timestamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 14         | 14       |
      | tag:"sample04061424" AND logtype:apache AND (NOT apache.request_query:*) \|dedup appname,apache.request_query  keepempty = true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 17         | 17       |
      | tag:"sample04061424" AND logtype:apache AND (NOT apache.request_query:*) \| dedup appname,apache.request_query keepempty = false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Su         | Su       |
      | tag:"sample04061424" \| eval f_agent_send = formatdate(agent_send_timestamp) \| eval f_collector_recv = formatdate(collector_recv_timestamp) \| eval f_timestamp = formatdate(timestamp) \| table agent_send_timestamp, f_agent_send, collector_recv_timestamp, f_collector_recv, timestamp,f_timestamp, raw_message                                                                                                                                                                                                                                                                                                                                                                                            | 验证         | 验证       |
      | index=yotta* starttime="-5h" endtime="now" * \| sort by timestamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Su         | Su       |
      | index=yotta* starttime="-5h" endtime="now" * \| sort by +timestamp \| table timestamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Su         | Su       |
      | index=* starttime="-50h" endtime="now" * \| top 10 appname \| limit 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Su         | Su       |
      | index=* starttime="-50h" endtime="now" * \| top 10 appname \| limit 10 \|sort by count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 10         | 10       |
      | index=* starttime="-50h" endtime="now" * \| stats count() as ct by appname \| limit 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Su         | Su       |
      | index=* starttime="-50h" endtime="now" * \| stats count() as ct by appname \| limit 10 \| sort by +ct                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 10         | 10       |
      | tag:sample04061424 \| eval trade_time=todouble(apache.resp_len) \| where trade_time>0.0 \| stats count() as count_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 69         | 69       |
      | tag:sample04061424 AND apache.resp_len:>0 \| eval trade_time=todouble(apache.resp_len) \| where trade_time>0.1 \| stats count() as count_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 69         | 69       |
      | tag:"sample04061424" \| stats count() as cnt by apache.status \| stats extend_stat(cnt)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 1行         | 1行       |
      | tag:"sample04061424" \| stats max(timestamp) by apache.method \| eval a = if(empty(apache.method), 1, 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 如果         | 如果       |
      | tag:"sample04061424" \| stats max(apache.status) as value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 结果         | 结果       |
      | tag:"t_with" \| transaction json.sid with states json.a,json.b,json.c in json.module results by flow                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Su         | Su       |
      | tag:"sample04061424" \| stats count(apache.status) as status by apache.clientip \| sort by +status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 72         | 72       |
      | tag:"sample04061424" \| eval aaa = formatdate(timestamp, "yyyy-MM-dd", "Asia/Shanghai") \| table aaa,timestamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 72         | 72       |
      | starttime="-5h/h" endtime="now" tag:"sample04061424"\| bucket timestamp span=10m as ts\|stats count(appname) as count_app by ts \| eval time=formatdate(ts)\| eval time_dis=formatdate(now()-ts, "HH:mm:ss")\|where ts>now()-18000000                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 30         | 30       |
      | index=schedule schedule_name:xxtest AND count_1:*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 前提         | 前提       |
      | index=schedule schedule_name:xxtest AND apache.status:>200 \| stats count() by apache.status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Su         | Su       |
      | tag:no \| stats count() as cnt by apache.status \| stats dc(cnt)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 如不         | 如不       |
      | * \| stats count() as cnt \| eval ttt = cnt + "  试试中文下载内容，⚠️"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Su         | Su       |
      | index=* tag:"sample04061424" \| transaction apache.status maxevents=10 \| bucket min_timestamp span=5m as ts \| stats avg(_duration) as base_len, count() as base_count, es(_duration) by ts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | es         | es       |
      | [[ tag:"sample04061424"\| stats avg(apache.resp_len) as avg_len by apache.clientip ]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Su         | Su       |






